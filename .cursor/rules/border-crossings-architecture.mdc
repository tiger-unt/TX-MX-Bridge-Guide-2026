---
description: Border Crossings Website - Core Architecture & Principles
alwaysApply: true
---

# Texas-Mexico Border Crossings Website Architecture

**Project Overview:** Automated website + PDF generation system for Texas-Mexico international border crossings guide. Replaces manual ArcGIS StoryMap workflow with single source of truth approach.

**Full Plan Reference:** See `Project_Plan/WEBSITE_DEVELOPMENT_PLAN.md` for complete details, timeline, and implementation phases.

## Project Structure

| Folder | Purpose |
|--------|---------|
| `Project_Plan/` | Development plan, process diagrams, planning docs |
| `Data/` | Border crossing source data. Main CSVs: `border-info-eng.csv` (crossing details, descriptions), `modes-info.csv` (hours, lanes per mode), `modes-tolls.csv` (tolls per mode). `Data/metadata/` has column dictionaries and lookup tables (crossings-dict, TxDOT-districts-dict, ports-of-entry-dict). |
| `Ref_Storymaps/` | Reference StoryMap content and analysis |
| `assets/` | Images, logos, graphics. Includes `icons/` (19 SVG mode icons) and per-crossing photo folders (e.g., `ELP-ELP-PASO/`). |
| `page-previews/` | Homepage template, CSS design system (`css/`), client-side JS (`js/`) |
| `app/` | Dynamic pages — homepage (`index.html` + `js/home-loader.js` + `js/md-utils.js`), bridge pages (HTML per crossing + `js/bridge-loader.js` + `js/csv-utils.js`), CSS (`css/home.css`, `css/bridge.css`), PDF templates (`pdf-templates/`) |
| `build-plans/` | Implementation plans and notes for features in progress |

## Core Architecture Principle

**Single Source of Truth:** All content managed in structured data files that automatically generate both website pages and PDF fact sheets.

## Three-Tier Data Management

1. **ArcGIS Online (AGOL) Web Map** - Interactive map display
   - Web Developer updates in AGOL portal
   - Changes appear instantly (no deployment needed)

2. **CSV Files** - Structured border crossing data (split by concern)
   - `border-info-eng.csv`: Names (EN/ES), location, ownership, descriptions, Bridge-ID
   - `modes-info.csv`: Inspection lanes, hours of operation, CBP/ADUANAS links (rows per mode)
   - `modes-tolls.csv`: Toll amounts by mode and axle (rows per mode/vehicle type)
   - Join key: Bridge-ID. Generates individual crossing pages and PDFs
   - Content Manager edits in SharePoint Excel

3. **Markdown Files** (`Data/`) - Long-form narrative content (✓ Implemented for homepage)
   - `Data/home-content-eng.md` — English homepage content (single source of truth)
   - Structured format: section delimiters, stat blocks, region/trend cards, standard markdown images/links
   - Client-side parsing by `md-utils.js` → `home-loader.js` → DOM population
   - Content Manager edits in SharePoint/GitHub
   - Authoring guide: `build-plans/MARKDOWN-CONTENT-SKILL.md`

## Critical Requirements

**Bilingual Content (EN/ES):**
- All crossing data must have English and Spanish versions
- PDF layouts must accommodate different text lengths
- Language switcher on all pages

**PDF Generation:**
- Must match 2-3 page format (mostly 3 pages)
- Automated generation from CSV data
- Pixel-perfect layout precision required

**Team Roles:**
- **Web Developer:** Data structure, build scripts, deployment, AGOL configuration
- **Content Manager:** Data accuracy, content updates, statistics, bilingual validation

## Key Technical Components

- Automated build system (CSV + Markdown → HTML + PDF) — Node.js build planned, not yet implemented
- Client-side CSV data loading — `app/js/csv-utils.js` parses CSVs, `app/js/bridge-loader.js` joins tables by Bridge-ID and renders pages
- Client-side markdown parsing — `app/js/md-utils.js` parses structured markdown, `app/js/home-loader.js` populates homepage DOM
- ArcGIS Online (AGOL) map integration with scroll animations — not yet started
- Single AGOL map reused across 3 region pages (different zoom/center)
- PDF factsheet generation — print CSS + template in `app/pdf-templates/`, download button on bridge pages
- Interactive data visualizations (converting static guidebook charts) — not yet started
- GitHub Pages deployment

## Bridge Page Architecture

Each crossing gets an HTML file in `app/` (e.g., `app/ELP-ELP-PASO.html`) that:
1. Loads shared CSS (`app/css/bridge.css`) and design system (`page-previews/css/`)
2. Loads `app/js/csv-utils.js` and `app/js/bridge-loader.js`
3. Bridge-loader reads all 3 CSV files, joins by Bridge-ID, and renders the page content
4. Print/PDF uses `app/pdf-templates/css/factsheet.css` + `page-previews/css/print.css`

## Homepage Architecture (Markdown-Driven)

`app/index.html` uses a markdown-driven pattern parallel to bridge pages:
1. Content in `Data/home-content-eng.md` — structured markdown with section delimiters
2. `md-utils.js` parses: frontmatter, `<!-- section: name -->` sections, `<!-- stats -->` blocks, `<!-- region: id -->` / `<!-- trend-card: type -->` cards, `<!-- source -->` citations
3. Images use `![alt](path)` and links use `[text](url)` (standard markdown, visible in viewers)
4. `home-loader.js` maps sections to DOM containers by ID convention (e.g., `trade-trends-header`, `trade-trends-stats`, `trade-trends-source`)
5. Nav & footer are hardcoded in HTML template (structural chrome)

## Content Update Workflow

- **AGOL Map:** Edit in portal → Save → Instant update
- **CSV:** Edit in SharePoint/GitHub → Build → Deploy
- **Markdown:** Edit in SharePoint/GitHub → Deploy → Auto-refresh (client-side parsing, no build step)
